#!/bin/bash
BUILD_DIR=$1
CACHE_DIR=$2
DEST_DIR=$BUILD_DIR/.heroku/vendor/jq
GEM_DIR=$BUILD_DIR/vendor/bundle/ruby/2.3.0

cd $CACHE_DIR

echo $BUILD_DIR
echo $CACHE_DIR
echo $DEST_DIR

mkdir -p $DEST_DIR

git clone https://github.com/stedolan/jq.git
cd jq
autoreconf -i
./configure --enable-shared
make
make install DESTDIR=$DEST_DIR

find $BUILD_DIR -name \*jq\* -print

GEM_HOME=$GEM_DIR GEM_PATH=$GEM_DIR gem install ruby-jq -- \
  --with-opt-lib="${DEST_DIR}/usr/local/lib" \
  --with-opt-include="${DEST_DIR}/usr/local/include"
